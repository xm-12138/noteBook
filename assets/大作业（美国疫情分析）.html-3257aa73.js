import{_ as n,o as a,c as e,a as t}from"./app-146e4e89.js";const p={};function o(c,s){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h2 id="文件预处理" tabindex="-1"><a class="header-anchor" href="#文件预处理" aria-hidden="true">#</a> 文件预处理</h2><p>对文件进行预处理</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看文件的前5行</span>
<span class="token function">head</span> <span class="token parameter variable">-5</span> /usr/local/bigdatacase/dataset/us-counties.csv

<span class="token comment"># 删除文件的第一行（将表头删除）</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;1d&#39;</span> /usr/local/bigdatacase/dataset/us-counties.csv

<span class="token comment">#查看是否删除成功</span>
<span class="token function">head</span> <span class="token parameter variable">-5</span> /usr/local/bigdatacase/dataset/us-counties.csv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建脚本" tabindex="-1"><a class="header-anchor" href="#创建脚本" aria-hidden="true">#</a> 创建脚本</h3><p>创建<code>pre_deal2.sh</code>文件</p><p>使用<code>vim /usr/local/bigdatacase/dataset/pre_deal2.sh</code> 创建脚本</p><p>写入以下内容</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#下面设置输入文件，把用户执行pre_deal.sh命令时提供的第一个参数作为输入文件名称</span>
<span class="token assign-left variable">infile</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token comment">#下面设置输出文件，把用户执行pre_deal.sh命令时提供的第二个参数作为输出文件名称</span>
<span class="token assign-left variable">outfile</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token comment">#注意！！最后的$infile &gt; $outfile必须跟在}’这两个字符的后面</span>
<span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&quot;,&quot;</span> <span class="token string">&#39;{
        id=id+1;     
        print id&quot;\\t&quot;$1&quot;\\t&quot;$2&quot;\\t&quot;$3&quot;\\t&quot;$4&quot;\\t&quot;$5}&#39;</span> <span class="token variable">$infile</span> <span class="token operator">&gt;</span> <span class="token variable">$outfile</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="执行脚本" tabindex="-1"><a class="header-anchor" href="#执行脚本" aria-hidden="true">#</a> 执行脚本</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">bash</span> /usr/local/bigdatacase/dataset/pre_deal2.sh <span class="token punctuation">\\</span>
/usr/local/bigdatacase/dataset/us-counties.csv <span class="token punctuation">\\</span>
/usr/local/bigdatacase/dataset/us-counties.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="上传至hdfs" tabindex="-1"><a class="header-anchor" href="#上传至hdfs" aria-hidden="true">#</a> 上传至HDFS</h2><p>将文件上传至HDFS文件系统<code>/usr/local/bigdatacase/dataset2</code> 目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 创建目录</span>
hdfs dfs <span class="token parameter variable">-mkdir</span> <span class="token parameter variable">-p</span> /bigdatacase/dataset2
<span class="token comment"># 文件上传至hdfs</span>
hdfs dfs <span class="token parameter variable">-put</span> /usr/local/bigdatacase/dataset/us-counties.txt /bigdatacase/dataset2
<span class="token comment"># 验证是否上传成功</span>
hdfs dfs <span class="token parameter variable">-cat</span> /bigdatacase/dataset2/us-counties.txt <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="上传至hive" tabindex="-1"><a class="header-anchor" href="#上传至hive" aria-hidden="true">#</a> 上传至hive</h2><h3 id="启动hive" tabindex="-1"><a class="header-anchor" href="#启动hive" aria-hidden="true">#</a> 启动hive</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>hive
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="在hive中创建外部表" tabindex="-1"><a class="header-anchor" href="#在hive中创建外部表" aria-hidden="true">#</a> 在hive中创建外部表</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> dblab<span class="token punctuation">.</span>covid_data <span class="token punctuation">(</span>
    id STRING <span class="token keyword">COMMENT</span> <span class="token string">&#39;主键，唯一标识每条记录&#39;</span><span class="token punctuation">,</span>
    report_date STRING <span class="token keyword">COMMENT</span> <span class="token string">&#39;日期&#39;</span><span class="token punctuation">,</span> 
    county STRING <span class="token keyword">COMMENT</span> <span class="token string">&#39;区县（州的下一级单位）&#39;</span><span class="token punctuation">,</span>
    state STRING <span class="token keyword">COMMENT</span> <span class="token string">&#39;州&#39;</span><span class="token punctuation">,</span>
    cases <span class="token keyword">INT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;截止该日期该区县的累计确诊人数&#39;</span><span class="token punctuation">,</span>
    deaths <span class="token keyword">INT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;截止该日期该区县的累计死亡人数&#39;</span>
<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
<span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">&#39;\\t&#39;</span>
STORED <span class="token keyword">AS</span> TEXTFILE
LOCATION <span class="token string">&#39;/bigdatacase/dataset2/&#39;</span><span class="token punctuation">;</span>

<span class="token comment"># 以下是创建内部表的语句</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dblab<span class="token punctuation">.</span>covid_data <span class="token punctuation">(</span>
		id STRING <span class="token keyword">comment</span> <span class="token string">&#39;主键，唯一标识每条记录&#39;</span><span class="token punctuation">,</span>
    report_date STRING <span class="token keyword">comment</span> <span class="token string">&#39;日期&#39;</span><span class="token punctuation">,</span> 
    county STRING <span class="token keyword">comment</span> <span class="token string">&#39;区县（州的下一级单位）&#39;</span><span class="token punctuation">,</span>
    state STRING <span class="token keyword">comment</span> <span class="token string">&#39;州&#39;</span><span class="token punctuation">,</span>
    cases <span class="token keyword">INT</span> <span class="token keyword">comment</span> <span class="token string">&#39;截止该日期该区县的累计确诊人数&#39;</span><span class="token punctuation">,</span>
    deaths <span class="token keyword">INT</span> <span class="token keyword">comment</span> <span class="token string">&#39;截止该日期该区县的累计死亡人数&#39;</span>
<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
<span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">&#39;\\t&#39;</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将表导入hive" tabindex="-1"><a class="header-anchor" href="#将表导入hive" aria-hidden="true">#</a> 将表导入hive</h3><p>如果创建的是外部表那么不用导入直接验证表中是否有数据就好</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 向covid_data表中导入数据</span>

<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> INPATH <span class="token string">&#39;/bigdatacase/dataset2/us-counties.txt&#39;</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> dblab<span class="token punctuation">.</span>covid_data<span class="token punctuation">;</span>

<span class="token comment"># 验证是否导入成功</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dblab<span class="token punctuation">.</span>covid_data <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将hive中的表数据导出到hdfs中" tabindex="-1"><a class="header-anchor" href="#将hive中的表数据导出到hdfs中" aria-hidden="true">#</a> 将hive中的表数据导出到hdfs中</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>INSERT OVERWRITE DIRECTORY <span class="token string">&#39;/user/hive/warehouse/dblab.db/covid_data_export&#39;</span>
ROW FORMAT DELIMITED
FIELDS TERMINATED BY <span class="token string">&#39;,&#39;</span>
SELECT * FROM dblab.covid_data<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql" aria-hidden="true">#</a> MySQL</h2><h3 id="创建表" tabindex="-1"><a class="header-anchor" href="#创建表" aria-hidden="true">#</a> 创建表</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dblab<span class="token punctuation">.</span>covid_data <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;主键，唯一标识每条记录&#39;</span><span class="token punctuation">,</span>
    report_date <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;日期&#39;</span><span class="token punctuation">,</span> 
    county <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;区县（州的下一级单位）&#39;</span><span class="token punctuation">,</span>
    state <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;州&#39;</span><span class="token punctuation">,</span>
    cases <span class="token keyword">INT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;截止该日期该区县的累计确诊人数&#39;</span><span class="token punctuation">,</span>
    deaths <span class="token keyword">INT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;截止该日期该区县的累计死亡人数&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="从hive导入mysql" tabindex="-1"><a class="header-anchor" href="#从hive导入mysql" aria-hidden="true">#</a> 从hive导入mysql</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sqoop <span class="token builtin class-name">export</span>   <span class="token parameter variable">--connect</span> jdbc:mysql://sqk01:3306/dblab <span class="token punctuation">\\</span>
  <span class="token parameter variable">--username</span> root   <span class="token punctuation">\\</span>
  <span class="token parameter variable">--password</span> <span class="token number">123</span> <span class="token punctuation">\\</span>
  <span class="token parameter variable">--table</span> covid_data   <span class="token punctuation">\\</span>
  --export-dir /user/hive/warehouse/dblab.db/covid_data_export   <span class="token punctuation">\\</span>
  --input-fields-terminated-by <span class="token string">&#39;,&#39;</span>   <span class="token punctuation">\\</span>
  --input-lines-terminated-by <span class="token string">&#39;\\n&#39;</span>   <span class="token punctuation">\\</span>
  <span class="token parameter variable">--columns</span> <span class="token string">&quot;id,report_date,county,state,cases,deaths&quot;</span>   <span class="token punctuation">\\</span>
  --num-mappers <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment"># 使用4个并行任务</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证数据" tabindex="-1"><a class="header-anchor" href="#验证数据" aria-hidden="true">#</a> 验证数据</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token keyword">select</span> * from dblab.covid_data  limit <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>为表添加主键（已废弃）</p><p>为表添加一个 <code>id</code> 列，并将其设为自增列和主键。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ALTER TABLE dblab.covid_data
ADD COLUMN <span class="token function">id</span> INT AUTO_INCREMENT PRIMARY KEY FIRST<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hbase-还未完成" tabindex="-1"><a class="header-anchor" href="#hbase-还未完成" aria-hidden="true">#</a> hbase（还未完成）</h2><h2 id="在hbase中创建表" tabindex="-1"><a class="header-anchor" href="#在hbase中创建表" aria-hidden="true">#</a> 在hbase中创建表</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>create <span class="token string">&#39;covid_data&#39;</span>, <span class="token punctuation">{</span> NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;f2&#39;</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="将数据从mysql中导入到hbase" tabindex="-1"><a class="header-anchor" href="#将数据从mysql中导入到hbase" aria-hidden="true">#</a> 将数据从mysql中导入到hbase</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sqoop  <span class="token function">import</span>  <span class="token parameter variable">--connect</span> jdbc:mysql://localhost:3306/dblab <span class="token parameter variable">--username</span> root <span class="token parameter variable">--password</span> <span class="token number">123</span> <span class="token parameter variable">--table</span> covid_data --hbase-table covid_data --column-family f2 --hbase-row-key <span class="token function">id</span> --hbase-create-table <span class="token parameter variable">-m</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="利用r进行数据可视化" tabindex="-1"><a class="header-anchor" href="#利用r进行数据可视化" aria-hidden="true">#</a> 利用R进行数据可视化</h2><h3 id="准备工作" tabindex="-1"><a class="header-anchor" href="#准备工作" aria-hidden="true">#</a> 准备工作</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 下载依赖</span>
install.packages<span class="token punctuation">(</span><span class="token string">&#39;dplyr&#39;</span><span class="token punctuation">)</span>
install.packages<span class="token punctuation">(</span><span class="token string">&#39;wordcloud&#39;</span><span class="token punctuation">)</span>

<span class="token comment">#建立数据库连接对象</span>
conn <span class="token operator">&lt;</span>- dbConnect<span class="token punctuation">(</span>MySQL<span class="token punctuation">(</span><span class="token punctuation">)</span>,dbname<span class="token operator">=</span><span class="token string">&#39;dblab&#39;</span>,username<span class="token operator">=</span><span class="token string">&#39;root&#39;</span>,password<span class="token operator">=</span><span class="token string">&#39;123&#39;</span>,host<span class="token operator">=</span><span class="token string">&quot;192.168.100.201&quot;</span>,port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">)</span>

library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>

<span class="token comment"># 将数据加载到数据框</span>
covid_data <span class="token operator">&lt;</span>- dbGetQuery<span class="token punctuation">(</span>conn,<span class="token string">&#39;select * from covid_data&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="绘制图表" tabindex="-1"><a class="header-anchor" href="#绘制图表" aria-hidden="true">#</a> 绘制图表</h3><p>（1）美国每日的累计确诊病例数和死亡数——&gt;双柱状图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code><span class="token comment"># 按日期汇总累计确诊和死亡病例</span>
covid_data<span class="token operator">$</span>report_date <span class="token operator">&lt;-</span> as.Date<span class="token punctuation">(</span>covid_data<span class="token operator">$</span>report_date<span class="token punctuation">,</span> format<span class="token operator">=</span><span class="token string">&quot;%Y/%m/%d&quot;</span><span class="token punctuation">)</span>
covid_agg <span class="token operator">&lt;-</span> covid_data <span class="token percent-operator operator">%&gt;%</span>
  group_by<span class="token punctuation">(</span>report_date<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  summarise<span class="token punctuation">(</span>cases <span class="token operator">=</span> sum<span class="token punctuation">(</span>cases<span class="token punctuation">)</span><span class="token punctuation">,</span> deaths <span class="token operator">=</span> sum<span class="token punctuation">(</span>deaths<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  arrange<span class="token punctuation">(</span>report_date<span class="token punctuation">)</span>

<span class="token comment"># 计算累计数</span>
covid_agg <span class="token operator">&lt;-</span> covid_agg <span class="token percent-operator operator">%&gt;%</span>
  mutate<span class="token punctuation">(</span>cumulative_cases <span class="token operator">=</span> cumsum<span class="token punctuation">(</span>cases<span class="token punctuation">)</span><span class="token punctuation">,</span> cumulative_deaths <span class="token operator">=</span> cumsum<span class="token punctuation">(</span>deaths<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制双柱状图</span>
ggplot<span class="token punctuation">(</span>covid_agg<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>report_date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_bar<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>y<span class="token operator">=</span>cumulative_cases<span class="token punctuation">)</span><span class="token punctuation">,</span> stat<span class="token operator">=</span><span class="token string">&quot;identity&quot;</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> position<span class="token operator">=</span><span class="token string">&quot;dodge&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_bar<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>y<span class="token operator">=</span>cumulative_deaths<span class="token punctuation">)</span><span class="token punctuation">,</span> stat<span class="token operator">=</span><span class="token string">&quot;identity&quot;</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> position<span class="token operator">=</span><span class="token string">&quot;dodge&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;美国每日的累计确诊病例数和死亡数&quot;</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">&quot;日期&quot;</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">&quot;病例数&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  theme<span class="token punctuation">(</span>axis.text.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span>angle <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）美国每日的新增确诊病例数——&gt;折线图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>covid_agg <span class="token operator">&lt;-</span> covid_agg <span class="token percent-operator operator">%&gt;%</span>
  mutate<span class="token punctuation">(</span>new_cases <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> diff<span class="token punctuation">(</span>cumulative_cases<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ggplot<span class="token punctuation">(</span>covid_agg<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>report_date<span class="token punctuation">,</span> y<span class="token operator">=</span>new_cases<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_line<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;美国每日的新增确诊病例数&quot;</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">&quot;日期&quot;</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">&quot;新增确诊病例数&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）美国每日的新增死亡病例数——&gt;折线图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>covid_agg <span class="token operator">&lt;-</span> covid_agg <span class="token percent-operator operator">%&gt;%</span>
  mutate<span class="token punctuation">(</span>new_deaths <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> diff<span class="token punctuation">(</span>cumulative_deaths<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ggplot<span class="token punctuation">(</span>covid_agg<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>report_date<span class="token punctuation">,</span> y<span class="token operator">=</span>new_deaths<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_line<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;美国每日的新增死亡病例数&quot;</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">&quot;日期&quot;</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">&quot;新增死亡病例数&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（4）截止5.19，美国各州累计确诊、死亡人数和病死率 -&gt; 表格</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>covid_state <span class="token operator">&lt;-</span> covid_data <span class="token percent-operator operator">%&gt;%</span>
  filter<span class="token punctuation">(</span>report_date <span class="token operator">&lt;=</span> <span class="token string">&quot;2020-05-19&quot;</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  group_by<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  summarise<span class="token punctuation">(</span>total_cases <span class="token operator">=</span> sum<span class="token punctuation">(</span>cases<span class="token punctuation">)</span><span class="token punctuation">,</span> total_deaths <span class="token operator">=</span> sum<span class="token punctuation">(</span>deaths<span class="token punctuation">)</span><span class="token punctuation">)</span>

covid_state <span class="token operator">&lt;-</span> covid_state <span class="token percent-operator operator">%&gt;%</span>
  mutate<span class="token punctuation">(</span>fatality_rate <span class="token operator">=</span> total_deaths <span class="token operator">/</span> total_cases <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment"># 打印表格</span>
covid_state

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（5）截止5.19，美国累计确诊人数前10的州 -&gt; 词云图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>RColorBrewer<span class="token punctuation">)</span>

library<span class="token punctuation">(</span>wordcloud<span class="token punctuation">)</span>

<span class="token comment"># 聚合数据：按州和日期汇总累计确诊和死亡人数</span>
covid_state <span class="token operator">&lt;-</span> covid_data <span class="token percent-operator operator">%&gt;%</span>
  filter<span class="token punctuation">(</span>report_date <span class="token operator">&lt;=</span> <span class="token string">&quot;2020-05-19&quot;</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  group_by<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  summarise<span class="token punctuation">(</span>total_cases <span class="token operator">=</span> sum<span class="token punctuation">(</span>cases<span class="token punctuation">)</span><span class="token punctuation">,</span> total_deaths <span class="token operator">=</span> sum<span class="token punctuation">(</span>deaths<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取累计确诊病例数前10的州</span>
covid_state_top10 <span class="token operator">&lt;-</span> covid_state <span class="token percent-operator operator">%&gt;%</span>
  arrange<span class="token punctuation">(</span>desc<span class="token punctuation">(</span>total_cases<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制词云图</span>
wordcloud<span class="token punctuation">(</span>words <span class="token operator">=</span> covid_state_top10<span class="token operator">$</span>state<span class="token punctuation">,</span> freq <span class="token operator">=</span> covid_state_top10<span class="token operator">$</span>total_cases<span class="token punctuation">,</span> 
          min.freq <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> scale <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colors <span class="token operator">=</span> brewer.pal<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&quot;Dark2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（6）截止5.19，美国累计死亡人数前10的州 -&gt; 象柱状图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code><span class="token comment"># 获取累计死亡人数前10的州</span>
covid_state_top10_deaths <span class="token operator">&lt;-</span> covid_state <span class="token percent-operator operator">%&gt;%</span>
  arrange<span class="token punctuation">(</span>desc<span class="token punctuation">(</span>total_deaths<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制象柱状图</span>
ggplot<span class="token punctuation">(</span>covid_state_top10_deaths<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>reorder<span class="token punctuation">(</span>state<span class="token punctuation">,</span> total_deaths<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token operator">=</span>total_deaths<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_bar<span class="token punctuation">(</span>stat<span class="token operator">=</span><span class="token string">&quot;identity&quot;</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token string">&quot;darkred&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  coord_flip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;累计死亡人数前10的州&quot;</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">&quot;州&quot;</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">&quot;累计死亡人数&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（7） 截止5.19，美国累计确诊人数最少的10个州 -&gt; 词云图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>covid_state_bottom10 <span class="token operator">&lt;-</span> covid_state <span class="token percent-operator operator">%&gt;%</span>
  arrange<span class="token punctuation">(</span>total_cases<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制词云图</span>
wordcloud<span class="token punctuation">(</span>words <span class="token operator">=</span> covid_state_bottom10<span class="token operator">$</span>state<span class="token punctuation">,</span> freq <span class="token operator">=</span> covid_state_bottom10<span class="token operator">$</span>total_cases<span class="token punctuation">,</span> 
          min.freq <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> scale <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colors <span class="token operator">=</span> brewer.pal<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&quot;Set3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（8）截止5.19，美国累计死亡人数最少的10个州 -&gt; 漏斗图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>ggplot<span class="token punctuation">(</span>covid_state_bottom10<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>reorder<span class="token punctuation">(</span>state<span class="token punctuation">,</span> total_deaths<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token operator">=</span>total_deaths<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_bar<span class="token punctuation">(</span>stat<span class="token operator">=</span><span class="token string">&quot;identity&quot;</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token string">&quot;lightblue&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  coord_flip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;累计死亡人数最少的10个州&quot;</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">&quot;州&quot;</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">&quot;累计死亡人数&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（9）截止5.19，美国的病死率 -&gt; 饼状图</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>covid_state <span class="token operator">&lt;-</span> covid_state <span class="token percent-operator operator">%&gt;%</span>
  mutate<span class="token punctuation">(</span>fatality_rate <span class="token operator">=</span> total_deaths <span class="token operator">/</span> total_cases <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>

fatality_rate <span class="token operator">&lt;-</span> sum<span class="token punctuation">(</span>covid_state<span class="token operator">$</span>total_deaths<span class="token punctuation">)</span> <span class="token operator">/</span> sum<span class="token punctuation">(</span>covid_state<span class="token operator">$</span>total_cases<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>

<span class="token comment"># 绘制饼状图</span>
pie<span class="token punctuation">(</span>c<span class="token punctuation">(</span>fatality_rate<span class="token punctuation">,</span> <span class="token number">100</span> <span class="token operator">-</span> fatality_rate<span class="token punctuation">)</span><span class="token punctuation">,</span> labels <span class="token operator">=</span> c<span class="token punctuation">(</span>paste<span class="token punctuation">(</span><span class="token string">&quot;病死率&quot;</span><span class="token punctuation">,</span> round<span class="token punctuation">(</span>fatality_rate<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;其他&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;grey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">&quot;美国病死率&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,60)])])}const i=n(p,[["render",o],["__file","大作业（美国疫情分析）.html.vue"]]);export{i as default};
